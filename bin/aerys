#!/usr/bin/env php
<?php

/**
 * Aerys HTTP Server
 *
 * Options:
 * --------
 * -c, --config     Use a config file to bootstrap the server
 * -p, --port       Optional port on which to listen (default: 80)
 * -i, --ip         Optional IP on which to bind (default: all IPv4 interfaces)
 * -n, --name       Optional host/domain name
 * -d, --docroot    The filesystem directory from which to serve static files
 * -h, --help       Display help screen
 *
 * Example Usage:
 * --------------
 * aerys -c /path/to/app/config.php
 * aerys --config /path/to/app/config.php
 * aerys --name mysite.com --docroot /path/to/document/root
 * aerys -p 1337 -d /path/to/doc/root
 * aerys --ip="[::]" -d /path/to/doc/root
 */

require __DIR__ . '/../vendor/autoload.php';

try {

    $reactor = (new Alert\ReactorFactory)->select();
    $server = new Aerys\Server($reactor);
    $bootstrapper = new Aerys\Framework\Bootstrapper($reactor, $server);
    $options = $bootstrapper->getCommandLineOptions();

    if ($bootstrapper->loadCommandLineConfig($options)) {
        $server->start();
        $reactor->run();
    }

} catch (Exception $e) {
    echo $e, "\n";
}
